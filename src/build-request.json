{
  "kind": "build_request",
  "title": "Add Manual Daily Reset System for Routines",
  "projectName": "Momentum",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Add a 'Reset New Day' button in the app header component (Header.tsx) positioned next to the dark mode toggle button",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "A 'Reset New Day' button next to the dark mode toggle in the app header"
        ]
      },
      "acceptanceCriteria": [
        "Button appears in the header next to the theme toggle",
        "Button is visible and accessible on both mobile and desktop views",
        "Button has appropriate styling consistent with the header design"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Modify MorningRoutine.tsx to implement frontend-only check/uncheck interaction with instant visual feedback without triggering backend saves on individual check/uncheck actions",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "Frontend-only check/uncheck interaction (instant visual feedback, no backend save)"
        ]
      },
      "acceptanceCriteria": [
        "Clicking routine checkboxes updates UI immediately",
        "No backend mutation calls are triggered on check/uncheck",
        "Routine checked state is maintained in local component state only"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update the strike count badge display logic in MorningRoutine.tsx to show strike count + 1 when a routine is checked (preview of tomorrow's count) and the current strike count when unchecked",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "Badge display logic: shows strike count + 1 when checked, strike count when unchecked"
        ]
      },
      "acceptanceCriteria": [
        "Badge shows current strike count for unchecked routines",
        "Badge shows strike count + 1 for checked routines",
        "Badge updates instantly when checking/unchecking routines"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Implement the manual reset workflow triggered by clicking the 'Reset New Day' button: save all currently checked routines to the backend (incrementing their strike counts by 1), reset all unchecked routines' strike counts to 0 in the backend, and clear all routine checkboxes back to unchecked state in the frontend",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "When 'Reset New Day' is clicked: Backend saves all currently checked routines (increases their strike counts by 1)",
          "Unchecked routines get their strike count reset to 0",
          "All checkboxes reset to unchecked state",
          "This is the ONLY time backend updates persist"
        ]
      },
      "acceptanceCriteria": [
        "Clicking 'Reset New Day' calls a backend function with the list of checked routine IDs",
        "Backend increments strike count by 1 for all checked routines",
        "Backend resets strike count to 0 for all unchecked routines",
        "Frontend clears all checkboxes to unchecked state after successful backend save",
        "User receives confirmation feedback when reset completes successfully",
        "Routine queries are invalidated to reflect updated strike counts"
      ]
    },
    {
      "id": "REQ-5",
      "text": "Add a backend function in main.mo to handle the manual daily reset, accepting an array of routine IDs that were checked, incrementing their strike counts by 1, and resetting strike counts to 0 for all other routines belonging to the user",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-recent"
        ],
        "quotes": [
          "Backend saves all currently checked routines (increases their strike counts by 1)",
          "Unchecked routines get their strike count reset to 0"
        ]
      },
      "acceptanceCriteria": [
        "New backend function accepts user principal and array of checked routine IDs",
        "Function increments strike count by 1 for routines in the checked array",
        "Function resets strike count to 0 for routines not in the checked array",
        "Function returns success/error result",
        "Proper authorization check ensures only the routine owner can trigger reset"
      ]
    },
    {
      "id": "REQ-6",
      "text": "Create a React Query mutation hook in useQueries.ts for the manual daily reset operation that calls the new backend function with checked routine IDs",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-recent"
        ]
      },
      "acceptanceCriteria": [
        "Mutation hook accepts array of checked routine IDs as parameter",
        "Hook triggers backend reset function when called",
        "Hook invalidates routine queries on success",
        "Hook provides loading, error, and success states"
      ]
    }
  ],
  "constraints": [
    "Preserve all existing UI elements from version 152 including sticky bottom button bar on mobile, full-width routine containers matching task containers, and working two-column layout toggle",
    "Do not modify the automatic daily reset logic or remove existing routine functionality beyond the check/uncheck behavior",
    "Maintain the existing MorningRoutine component structure and styling",
    "Ensure the manual reset is the ONLY time routine completion state persists to the backend"
  ],
  "nonGoals": [
    "Modifying task management functionality",
    "Changing the automatic date detection or rollover logic beyond the manual reset",
    "Altering the routine creation or deletion flows",
    "Implementing automatic reset triggers or scheduled resets"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}